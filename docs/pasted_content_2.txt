Excelente\! Agora vamos detalhar o **Back-end** do seu App de Investimentos, que é o coração da lógica de negócios, da análise de dados e da comunicação em tempo real.

[cite\_start]O prompt a seguir se concentra em uma arquitetura **microserviços** para tirar proveito do **Node.js/Express** (ótimo para APIs e WebSockets de alto desempenho) e do **Python** (ideal para análise de dados e IA), conforme sugerido na arquitetura[cite: 10, 11].

-----

## Prompt Detalhado para Geração de Back-End (Node.js + Python Engine)

Crie a estrutura de diretórios e o código base para o **Back-end** do App de Investimentos B3. O Back-end será construído em uma arquitetura de serviços separados: um **Servidor Principal (Node.js/Express)** e um **Motor de Análise (Python)**.

### 1\. Stack Tecnológica e Ferramentas

[cite\_start]O back-end deve ser desenvolvido com as seguintes tecnologias principais, seguindo o padrão robusto para aplicações financeiras[cite: 321, 325, 330, 331, 334]:

#### Servidor Principal (Node.js/Express):

  * [cite\_start]**Runtime:** Node.js 20+ LTS [cite: 325]
  * [cite\_start]**Framework:** Express 4+ [cite: 326]
  * [cite\_start]**Banco de Dados:** PostgreSQL 15+ (com extensão **TimescaleDB** para dados de mercado) [cite: 330]
  * [cite\_start]**Cache/Mensageria:** Redis 7+ [cite: 331, 12]
  * [cite\_start]**ORM:** Sequelize ou Prisma [cite: 333]
  * [cite\_start]**WebSocket:** Socket.IO [cite: 334]
  * [cite\_start]**Fila de Tarefas:** Bull / BullMQ (para processamento assíncrono de ordens e relatórios) [cite: 335, 223]
  * [cite\_start]**Autenticação:** JWT + Passport.js [cite: 337]

#### Motor de Análise/IA (Python):

  * [cite\_start]**Framework:** Flask/FastAPI (Para expor a lógica de IA via API interna) [cite: 260]
  * [cite\_start]**Análise de Dados:** Pandas, NumPy, SciPy [cite: 11]
  * [cite\_start]**IA/ML:** scikit-learn, TensorFlow/PyTorch (Para modelos preditivos e de risco) [cite: 11]
  * [cite\_start]**Web Scraping:** Beautiful Soup, Scrapy (Para coleta de notícias) [cite: 11, 16]

### 2\. Estrutura de Diretórios (Mandatório)

Gere a estrutura de pastas e arquivos dentro da pasta raiz `investment-app/` para acomodar os dois serviços:

#### Módulo Node.js (`backend/`)

```
investment-app/
└── backend/
    ├── src/
    │   ├── config/              # Configurações do ambiente e serviços
    │   │   ├── database.js      # Conexão PostgreSQL/TimescaleDB
    │   │   ├── redis.js         # Conexão Redis
    │   │   ├── b3.config.js     # Chaves e URLs da B3/Provedores
    │   │   └── environment.js
    │   ├── controllers/         # Lógica de manipulação de requisições (API)
    │   │   ├── auth.controller.js
    │   │   ├── kyc.controller.js
    │   │   ├── trading.controller.js
    │   │   ├── market.controller.js
    │   │   ├── portfolio.controller.js
    │   │   ├── orders.controller.js
    │   │   └── reports.controller.js
    │   ├── models/              # Modelos de Dados (Sequelize/Mongoose)
    │   │   ├── User.js
    │   │   ├── Account.js
    │   │   ├── Order.js
    │   │   ├── Position.js
    │   │   ├── Transaction.js
    │   │   └── AuditLog.js
    │   ├── routes/              # Rotas da API (Express)
    │   │   ├── index.js
    │   │   ├── auth.routes.js
    │   │   ├── trading.routes.js
    │   │   ├── market.routes.js
    │   │   ├── portfolio.routes.js
    │   │   └── admin.routes.js
    │   ├── services/            # Lógica de Negócio (Camada de Serviço)
    │   │   ├── auth/
    │   │   │   ├── auth.service.js
    │   │   │   ├── jwt.service.js
    │   │   │   └── 2fa.service.js
    │   │   ├── trading/
    │   │   │   ├── order.service.js
    │   │   │   ├── execution.service.js
    │   │   │   └── risk.service.js
    │   │   ├── market/
    │   │   │   ├── market-data.service.js
    │   │   │   ├── fundamentals.service.js
    │   │   │   └── news.service.js
    │   │   ├── portfolio/
    │   │   │   ├── portfolio.service.js
    │   │   │   ├── performance.service.js
    │   │   │   └── rebalance.service.js
    │   │   ├── compliance/
    │   │   │   ├── kyc.service.js (Integração Serpro)
    │   │   │   ├── aml.service.js
    │   │   │   └── suitability.service.js
    │   │   └── integrations/
    │   │       ├── b3.service.js (PUMA Trading System)
    │   │       ├── puma.service.js
    │   │       ├── serpro.service.js
    │   │       ├── pix.service.js (Integração BACEN)
    │   │       └── tesouro-direto.service.js
    │   ├── middleware/          # Middlewares (Autenticação, Rate Limit, etc.)
    │   │   ├── auth.middleware.js
    │   │   ├── rate-limit.middleware.js
    │   │   ├── validation.middleware.js
    │   │   └── error.middleware.js
    │   ├── websocket/           # Servidor WebSocket (Socket.IO)
    │   │   ├── server.js
    │   │   ├── handlers/
    │   │   │   ├── market-data.handler.js
    │   │   │   ├── order-updates.handler.js
    │   │   │   └── notifications.handler.js
    │   │   └── rooms/
    │   │       └── room-manager.js
    │   ├── workers/             # Processamento Assíncrono (Bull Queue)
    │   │   ├── market-data.worker.js
    │   │   ├── order-processor.worker.js
    │   │   └── report-generator.worker.js
    │   ├── validators/          # Schemas de Validação (Joi/Zod)
    │   │   ├── auth.validator.js
    │   │   └── order.validator.js
    │   ├── utils/               # Utilitários
    │   │   ├── logger.js
    │   │   └── encryption.js
    │   ├── app.js               # Configuração do Express App
    │   └── server.js            # Ponto de entrada (Inicialização do Express)
    ├── package.json
    └── .env.example             # Variáveis de ambiente
```

#### Módulo Python (`analytics-engine/`)

```
investment-app/
└── analytics-engine/
    ├── src/
    │   ├── ml_models/           # Modelos de Machine Learning
    │   │   ├── price_prediction.py
    │   │   ├── risk_analysis.py
    │   │   └── fraud_detection.py
    │   ├── indicators/          # Cálculos de Indicadores
    │   │   ├── technical.py
    │   │   └── fundamentals.py
    │   ├── api/                 # Endpoint Flask/FastAPI para o Node.js
    │   │   └── flask_app.py     # Inicialização e rotas internas (ex: /analyze_risk)
    │   └── data_pipeline.py     # Lógica de scraping e pré-processamento
    └── requirements.txt         # Dependências Python (Pandas, Scikit-learn, etc.)
```

### 3\. Implementações Iniciais do Código (Focus no Node.js)

1.  **`backend/package.json`**: Configure as dependências (Express, Socket.IO, Sequelize, Redis Client, JWT, Bull, etc.) e o script de inicialização (`"start": "node src/server.js"`, `"dev": "nodemon src/server.js"`).
2.  **`backend/src/config/database.js`**: Implemente a conexão básica com o **PostgreSQL** usando o ORM escolhido.
3.  **`backend/src/models/User.js`**: Crie o modelo `User` (id, email, password\_hash, kyc\_status) com o ORM.
4.  **`backend/src/routes/auth.routes.js`**: Crie a rota POST `/api/v1/auth/login` que chama `auth.controller.js`.
5.  **`backend/src/controllers/auth.controller.js`**: Crie a função de login que usa `auth.service.js` para verificar a senha (com **bcrypt**) e gerar um **JWT**.
6.  **`backend/src/websocket/server.js`**: Inicialize o **Socket.IO server** e um handler básico para receber e emitir cotações (simuladas) para o Front-end.

### 4\. Implementações Iniciais do Código (Focus no Python Engine)

1.  **`analytics-engine/requirements.txt`**: Liste as dependências Python essenciais (`pandas`, `scikit-learn`, `flask`).
2.  **`analytics-engine/src/api/flask_app.py`**: Crie uma aplicação Flask mínima com uma rota de teste:
      * **GET `/analyze_risk`**: Deve retornar um JSON simulando a saída de um modelo de risco (ex: `{"asset": "PETR4", "risk_score": 0.75}`).

### 5\. Configuração de Comunicação entre Serviços

Adicione um arquivo `docker-compose.yml` na raiz (`investment-app/`) para definir e orquestrar os serviços **`frontend`**, **`backend`** (Node.js), **`analytics-engine`** (Python), **`postgresql`** e **`redis`**, garantindo que:

  * O serviço Node.js possa acessar o PostgreSQL, Redis, e o Python Engine por nomes de rede (ex: `http://analytics-engine:5000`).
  * O serviço Node.js exponha as portas da API (ex: `3000`) e do WebSocket (ex: `3001`).

[cite\_start]Esta separação clara garantirá a escalabilidade e a performance em tempo real exigidas pelo projeto[cite: 3, 14, 512].